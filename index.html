<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TuanMuda</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-sm fixed-top custom-navbar">
      <div class="container-fluid">
        <a href="#header" class="navbar-brand">TuanMuda</a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a href="#about" class="nav-link">About</a>
            </li>
            <li class="nav-item">
              <a href="#services" class="nav-link">Services</a>
            </li>
            <li class="nav-item">
              <a href="#products" class="nav-link">Products</a>
            </li>
            <li class="nav-item">
              <a href="#testimonial" class="nav-link">Testimonial</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Header -->
    <header
      id="header"
      class="header-section d-flex align-items-center text-black"
    >
      <div class="container-fluid">
        <div class="row align-items-center">
          <div class="col-md-6 text-md-start">
            <h1>Top Up game murah <br />aman dan terpercaya</h1>
            <p>
              Top Up game, aplikasi bahkan <br />
              pulsa tanpa ribet hanya di sini!
            </p>
            <form action="#products">
              <button class="btn gold text-light mt-1">Mulai Top Up</button>
            </form>
            <img
              src="assets/angela kishin densetsu.png"
              decoding="async"
              fetchpriority="high"
              alt="Header Image"
              class="hero-img"
            />
          </div>
        </div>
      </div>
    </header>

    <!-- About -->
    <section id="about" class="py-5">
      <div class="container">
        <div class="row-about row align-items-center">
          <div class="img-about col-md-6 text-center mb-md-0">
            <img src="assets/tuanMuda.png" alt="Tentang Kami" />
          </div>
          <div class="text-about col-md-6">
            <h3 class="fw-semibold">Tentang Kami</h3>
            <p class="p-about">
              TuanMuda adalah layanan top up yang hadir untuk memudahkan kamu
              melakukan top up game, aplikasi, dan pulsa dengan cepat, aman, dan
              terpercaya.
            </p>

            <div class="d-flex flex-wrap gap-3">
              <div class="stat-card text-center flex-fill">
                <h4 class="mb-0">2</h4>
                <p class="mb-0 mt-1">Tahun<br />Berjalan</p>
              </div>
              <div class="stat-card text-center flex-fill">
                <h4 class="mb-0">5+</h4>
                <p class="mb-0 mt-1">Pilihan<br />Aplikasi</p>
              </div>
              <div class="stat-card text-center flex-fill">
                <h4 class="mb-0">10k+</h4>
                <p class="mb-0 mt-1">Pelanggan<br />Puas</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <div class="bg">
      <!-- Services -->
      <section id="services" class="py-5">
        <div class="container text-center">
          <h1 class="title mb-5">Kami Melayani</h1>
          <div class="row justify-content-center g-4">
            <div class="col-md-4 col-sm-6">
              <div class="card card-service p-4 shadow-sm border-0 rounded-4">
                <div class="card-body">
                  <i class="bi bi-controller display-5"></i>
                  <h5 class="mt-3 fw-semibold">Top Up Game</h5>
                  <p>Harga murah, transaksi cepat, 100% legal</p>
                </div>
              </div>
            </div>
            <div class="col-md-4 col-sm-6">
              <div class="card card-service p-4 shadow-sm border-0 rounded-4">
                <div class="card-body">
                  <i class="bi bi-lightning-charge display-5"></i>
                  <h5 class="mt-3 fw-semibold">Entertainment</h5>
                  <p>Top up mudah, hiburan puas tanpa batas</p>
                </div>
              </div>
            </div>
            <div class="col-md-4 col-sm-6">
              <div class="card card-service p-4 shadow-sm border-0 rounded-4">
                <div class="card-body">
                  <i class="bi bi-currency-exchange display-5"></i>
                  <h5 class="mt-3 fw-semibold">Pulsa</h5>
                  <p>Top up cepat, chat gak sempat putus</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- highlight -->
      <div class="bg-highlight">
        <section class="highlight container">
          <div class="row align-items-center">
            <div class="isi col-lg-6 text-light">
              <h2 class="fw-bold mb-3">Top Up Game Populer</h2>
              <p class="text-secondary mb-4">
                Misi Top Up? Packet Bundle? Serahkan pada kami! Nikmati Top Up
                game murah, cepat dan terpercaya hanya di TuanMuda.
              </p>
              <a
                href="#game"
                class="btn btn-warning btn-lg fw-bold"
                onclick="selectCategory('game')"
                >Top Up Sekarang</a
              >
            </div>
            <div class="col-lg-6 text-center">
              <div class="p-4">
                <img
                  src="assets/high3.jpg"
                  alt="Product"
                  class="img-fluid alpa rounded-4"
                />
              </div>
            </div>
          </div>
        </section>

        <!-- highlight bawah -->
        <section class="highlight-bottom container py-5">
          <div class="row align-items-center">
            <div class="isi col-lg-6">
              <img
                src="assets/high2.jpg"
                alt="Product"
                class="img-fluid rounded-4"
              />
            </div>
            <div class="isi col-lg-6 text-light mt-4 mt-lg-0">
              <h2 class="fw-bold mb-3">Top Up Hiburan</h2>
              <p class="text-secondary mb-4">
                Ga perlu takut telat atau lupa berlangganan aplikasi favoritmu,
                karena kami juga menyediakan top up untuk berbagai layanan
                hiburan populer!
              </p>
              <a
                href="#entertainment"
                class="btn btn-lg fw-bold"
                onclick="selectCategory('entertainment')"
                >Berlangganan Sekarang</a
              >
            </div>
          </div>
        </section>
      </div>

      <!-- Products -->
      <section id="products" class="py-5">
        <div class="container text-center">
          <h2 class="fw-bold mb-4">Game</h2>
          <div class="category-container mb-4">
            <button id="game" class="category-btn active" data-category="game">
              Game
            </button>
            <button
              id="entertainment"
              class="category-btn"
              data-category="entertainment"
            >
              Entertainment
            </button>
            <button class="category-btn" data-category="pulsa">Pulsa</button>
          </div>
          <div id="product-list"></div>
        </div>
      </section>

      <section id="checkout" class="d-none"></section>

      <!-- banner -->
      <div class="banner my-5">
        <div class="get-started-section">
          <!-- Foto profil melayang -->
          <img src="assets/splash1.jpg" class="profile-img img1" alt="" />
          <img src="assets/splash2.jpg" class="profile-img img2" alt="" />
          <img src="assets/splash3.jpg" class="profile-img img3" alt="" />
          <img src="assets/splash4.jpg" class="profile-img img4" alt="" />
          <img src="assets/splash5.jpg" class="profile-img img5" alt="" />
          <img src="assets/splash6.jpg" class="profile-img img6" alt="" />
          <img src="assets/splash7.jpg" class="profile-img img7" alt="" />

          <!-- Konten utama -->
          <h2>Transaksi Bermasalah?</h2>
          <p>
            Bagi para pelanggan yang mengalami kendala dalam transaksi, silakan
            hubungi kami melalui WhatsApp. Kami siap membantu menyelesaikan
            masalah Anda dengan cepat dan efisien.
          </p>
          <button class="btn">Hubungi Kami →</button>
        </div>
      </div>

      <!-- testimonial -->
      <section id="testimonial" class="testimonial-section">
        <h2 class="text-center fw-bold mt-4">Testimonial</h2>
        <div class="container">
          <div class="row text-start g-4">
            <div class="carousel-atas">
              <div class="testi-atas" id="testi-atas-1"></div>
              <div class="aria-hidden testi-atas" id="testi-atas-2"></div>
            </div>
            <div class="carousel-bawah">
              <div class="testi-bawah" id="testi-bawah-1"></div>
              <div class="aria-hidden testi-bawah" id="testi-bawah-2"></div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- footer -->
    <footer class="footer">
      <div class="container">
        <div class="footer-left">
          <a href="#header" class="footer-brand">TuanMuda</a>
          <p class="footer-desc">
            Selamat datang di TuanMuda, platform terbaik untuk layanan top-up
            game, entertainment dan pulsa terpercaya! Kami hadir untuk membantu
            para gamer menikmati pengalaman bermain yang lebih seru, cepat, dan
            tanpa ribet.
          </p>

          <div class="footer-socials">
            <a
              href="https://www.instagram.com/mobilelegendsgame"
              target="_blank"
            >
              <img src="assets/ig.png" alt="Instagram" />
            </a>
            <a href="https://www.tiktok.com/@mobilelegendsgame" target="_blank">
              <img src="assets/tiktok.png" alt="TikTok" />
            </a>
            <a
              href="https://www.youtube.com/@MobileLegends5v5MOBA"
              target="_blank"
            >
              <img src="assets/yt.png" alt="YouTube" />
            </a>
          </div>
        </div>

        <div class="footer-col">
          <h4>Hubungi Kami</h4>
          <ul>
            <li>
              <a
                href="https://wa.me/6281380368831?text=Halo%20Minpap%2C%20saya%20ingin%20bertanya%20tentang%20layanan%20TuanMuda"
                target="_blank"
                >Chat Admin</a
              >
            </li>
            <li><a href="mailto:muhsharlan8@gmail.com">Email</a></li>
          </ul>
        </div>

        <div class="footer-col">
          <h4>Legalitas</h4>
          <ul>
            <li><a href="#" id="privacyLink">Kebijakan Privasi</a></li>
            <li><a href="#" id="termsLink">Syarat & Ketentuan</a></li>
          </ul>
        </div>
      </div>

      <div class="footer-bottom text-center mt-4">
        <p>© 2025 TuanMuda. All rights reserved.</p>
      </div>
    </footer>

    <!-- MODAL: KEBIJAKAN PRIVASI -->
    <div
      class="modal fade"
      id="privacyModal"
      tabindex="-1"
      aria-labelledby="privacyModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="privacyModalLabel">
              Kebijakan Privasi
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p>
              Kami di TuanMuda menghargai privasi Anda. Informasi pribadi yang
              Anda berikan saat melakukan transaksi hanya digunakan untuk
              memproses pesanan, verifikasi, dan meningkatkan layanan kami. Kami
              tidak akan menjual atau membagikan data Anda kepada pihak ketiga
              tanpa izin Anda, kecuali diwajibkan oleh hukum.
            </p>
            <p>
              Dengan menggunakan layanan kami, Anda menyetujui pengumpulan dan
              penggunaan informasi sesuai dengan kebijakan ini.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL: SYARAT & KETENTUAN -->
    <div
      class="modal fade"
      id="termsModal"
      tabindex="-1"
      aria-labelledby="termsModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="termsModalLabel">Syarat & Ketentuan</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p>
              Dengan menggunakan layanan TuanMuda, pengguna dianggap telah
              membaca dan menyetujui seluruh syarat dan ketentuan berikut:
            </p>
            <ul>
              <li>
                Transaksi yang telah berhasil tidak dapat dibatalkan atau
                dikembalikan.
              </li>
              <li>
                Pastikan data yang Anda masukkan (seperti ID game atau nomor
                tujuan) benar sebelum melakukan pembayaran.
              </li>
              <li>
                Kami berhak menolak pesanan yang mencurigakan atau tidak sesuai
                dengan kebijakan kami.
              </li>
              <li>
                Kami tidak bertanggung jawab atas kesalahan penginputan data
                oleh pengguna.
              </li>
            </ul>
            <p>
              TuanMuda berhak mengubah ketentuan ini sewaktu-waktu tanpa
              pemberitahuan sebelumnya.
            </p>
          </div>
        </div>
      </div>
    </div>
    <script>
      // Deklarasi variabel kosong dulu (akan diisi dari database)
      let products = { game: [], entertainment: [], pulsa: [] };
      let checkoutData = {};

      // Load products dari database
      async function loadProductsFromDB() {
        try {
          const response = await fetch("backend/get_products.php");
          const result = await response.json();

          if (result.success) {
            // Reset products
            products = { game: [], entertainment: [], pulsa: [] };

            // Group by category
            result.data.forEach((p) => {
              products[p.category].push({
                name: p.name,
                img: p.img,
                id: p.id,
              });
            });

            // Render products game (default)
            renderProducts(products.game);
          }
        } catch (error) {
          console.error("Error loading products:", error);
        }
      }

      // Load detail produk saat diklik
      async function loadProductDetail(productName) {
        try {
          const response = await fetch(
            `backend/get_product_detail.php?name=${encodeURIComponent(
              productName
            )}`
          );
          const result = await response.json();

          if (result.success) {
            const p = result.data;

            // Build checkoutData dari database
            checkoutData[productName] = {
              img: p.img,
              title: p.title,
              tag: p.tag,
              cara: p.cara,
              diamond: p.item_label,
              paket: p.package_label,
              steps: [
                `Pilih Tipe ${p.cara} yang kamu inginkan`,
                p.input_label,
                "Pilih metode pembayaran",
                "Selesaikan pembayaran",
                `Item akan otomatis masuk ke akun ${productName} kamu`,
              ],
              diamonds: p.diamonds.map((d) => ({
                img: d.img,
                name: d.name,
                bonus: d.bonus,
                price: `Rp. ${parseInt(d.price).toLocaleString("id-ID")}`,
              })),
              packages: p.packages.map((pkg) => ({
                img: pkg.img,
                name: pkg.name,
                price: `Rp. ${parseInt(pkg.price).toLocaleString("id-ID")}`,
              })),
              inputType: p.input_type,
              inputLabel: p.input_label,
              inputPlaceholder:
                p.input_type === "game-with-zone"
                  ? {
                      userId: p.input_placeholder_userid,
                      zoneId: p.input_placeholder_zoneid,
                    }
                  : p.input_placeholder_userid,
              inputHelp: p.input_help,
            };

            // Panggil showCheckout dengan data dari database
            showCheckout(productName);
          }
        } catch (error) {
          console.error("Error loading product detail:", error);
          alert("Gagal memuat detail produk");
        }
      }

      const paymentMethods = {
        ewallet: {
          title: "E-Wallet dan QRIS",
          fee: 1000,
          methods: [
            { name: "GoPay", img: "assets/gopay.png", id: "gopay" },
            { name: "DANA", img: "assets/dana.png", id: "dana" },
            { name: "OVO", img: "assets/ovo.png", id: "ovo" },
            { name: "QRIS", img: "assets/qris.png", id: "qris" },
          ],
        },

        virtual_account: {
          title: "Virtual Account",
          fee: 2000,
          methods: [
            {
              name: "BCA",
              img: "assets/bca.png",
              id: "bca_va",
            },
            {
              name: "BRI",
              img: "assets/bri.png",
              id: "bri_va",
            },
            {
              name: "BNI",
              img: "assets/bni.png",
              id: "bni_va",
            },
            {
              name: "Mandiri",
              img: "assets/mandiri.png",
              id: "mandiri_va",
            },
          ],
        },

        gerai: {
          title: "Gerai",
          fee: 3000,
          methods: [
            { name: "Alfamart", img: "assets/alfamart.png", id: "alfamart" },
            { name: "Indomaret", img: "assets/indomaret.png", id: "indomaret" },
          ],
        },
      };

      let selectedItemData = {
        productName: "",
        itemName: "",
        itemPrice: 0,
      };

      let selectedPaymentMethod = {
        id: "",
        name: "",
        totalPrice: 0,
      };

      // TAMBAHKAN 3 FUNGSI INI
      function updateBottomNavbar() {
        let bottomNav = document.getElementById("bottom-navbar");

        if (!selectedItemData.itemName) {
          if (bottomNav) {
            bottomNav.classList.add("d-none");
          }
          return;
        }

        if (!bottomNav) {
          bottomNav = document.createElement("div");
          bottomNav.id = "bottom-navbar";
          bottomNav.className = "bottom-navbar";
          document.body.appendChild(bottomNav);
        }

        const isInputValid = validateUserInput();
        const isPaymentSelected = selectedPaymentMethod.id !== "";
        const canCheckout = isInputValid && isPaymentSelected;

        let errorMessage = "";
        if (!isInputValid) {
          const inputType =
            checkoutData[selectedItemData.productName].inputType;
          if (inputType === "game-with-zone" || inputType === "game") {
            errorMessage = "Isi User ID terlebih dahulu";
          } else if (inputType === "email") {
            errorMessage = "Isi Email terlebih dahulu";
          } else if (inputType === "phone") {
            errorMessage = "Isi No HP terlebih dahulu";
          }
        } else if (!isPaymentSelected) {
          errorMessage = "Pilih metode pembayaran";
        }

        const totalPrice =
          selectedPaymentMethod.totalPrice || selectedItemData.itemPrice;

        bottomNav.innerHTML = `
    <div class="bottom-navbar-content">
      <div class="bottom-navbar-info">
        <div class="navbar-item-name">${selectedItemData.itemName}</div>
        <div class="navbar-total-price">Total: Rp${totalPrice.toLocaleString(
          "id-ID"
        )}</div>
      </div>
      <button 
        class="btn-checkout ${!canCheckout ? "disabled" : ""}" 
        ${!canCheckout ? "disabled" : ""}
        onclick="processCheckout()"
      >
        ${canCheckout ? "Beli Sekarang" : errorMessage}
      </button>
    </div>
  `;

        bottomNav.classList.remove("d-none");
      }

      function validateUserInput() {
        const data = checkoutData[selectedItemData.productName];

        if (data.inputType === "game-with-zone") {
          const userId = document.getElementById("userId");
          const zoneId = document.getElementById("zoneId");
          return (
            userId &&
            zoneId &&
            userId.value.trim() !== "" &&
            zoneId.value.trim() !== ""
          );
        } else if (data.inputType === "game") {
          const userId = document.getElementById("userId");
          return userId && userId.value.trim() !== "";
        } else if (data.inputType === "email") {
          const email = document.getElementById("userEmail");
          return email && email.value.trim() !== "" && email.validity.valid;
        } else if (data.inputType === "phone") {
          const phone = document.getElementById("userPhone");
          return phone && phone.value.trim() !== "" && phone.value.length >= 10;
        }

        return false;
      }

      async function processCheckout() {
        const data = checkoutData[selectedItemData.productName];
        let userInput = {};

        if (data.inputType === "game-with-zone") {
          userInput.userId = document.getElementById("userId").value;
          userInput.zoneId = document.getElementById("zoneId").value;
        } else if (data.inputType === "game") {
          userInput.userId = document.getElementById("userId").value;
        } else if (data.inputType === "email") {
          userInput.email = document.getElementById("userEmail").value;
        } else if (data.inputType === "phone") {
          userInput.phone = document.getElementById("userPhone").value;
        }

        // Data yang akan dikirim ke backend
        const transactionData = {
          product_name: selectedItemData.productName,
          item_name: selectedItemData.itemName,
          item_price: selectedItemData.itemPrice,
          payment_method: selectedPaymentMethod.name,
          payment_category: selectedPaymentMethod.category,
          total_price: selectedPaymentMethod.totalPrice,
          user_input: userInput,
        };

        console.log("=== MENGIRIM DATA KE BACKEND ===");
        console.log(transactionData);

        // Tampilkan loading di tombol
        const btnCheckout = document.querySelector(".btn-checkout");
        const originalText = btnCheckout.textContent;
        btnCheckout.disabled = true;
        btnCheckout.innerHTML =
          '<span class="spinner-border spinner-border-sm me-2"></span>Processing...';

        try {
          // Kirim ke backend PHP
          const response = await fetch("backend/create_transaction.php", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(transactionData),
          });

          const result = await response.json();

          if (result.success) {
            console.log("✅ Response dari backend:", result);

            // BUKA TAB BARU untuk status page
            window.open(`status.html?order_id=${result.order_id}`, "_blank");

            // Reset form dan kembali ke products
            setTimeout(() => {
              // Reload transaksi jika section visible
              if (document.getElementById("transactions-tbody")) {
                loadAllTransactions();
              }
            }, 500);
          } else {
            // Reset button
            btnCheckout.disabled = false;
            btnCheckout.textContent = originalText;

            alert(`❌ Transaksi Gagal!\n\n${result.message}`);
            console.error("❌ Error:", result);
          }
        } catch (error) {
          // Reset button
          btnCheckout.disabled = false;
          btnCheckout.textContent = originalText;

          alert(
            `❌ Terjadi kesalahan!\n\n` +
              `Tidak dapat terhubung ke server.\n` +
              `Pastikan XAMPP sudah running.\n\n` +
              `Error: ${error.message}`
          );
          console.error("❌ Fetch error:", error);
        }
      }

      /* ================== RENDER PRODUK ================== */
      function renderProducts(list) {
        const existingList = document.getElementById("product-list");
        existingList.innerHTML = `<div class="row g-4 justify-content-center"></div>`;

        const row = existingList.querySelector(".row");

        list.forEach((p) => {
          const col = document.createElement("div");
          col.className = "card-container col-6 col-md-4 col-lg-3";

          col.innerHTML = `
            <div class="product-card h-100 shadow-sm" onclick="loadProductDetail('${p.name}')">
              <div class="img-container">
                <img src="${p.img}" alt="${p.name}">
              </div>
              <div class="card-body text-center">
                <h6 class="fw-bold text-dark">${p.name}</h6>
              </div>
            </div>
          `;

          row.appendChild(col);
        });
      }

      function renderInputForm(data) {
        if (data.inputType === "game-with-zone") {
          return `
      <div class="input-container mb-4">
        <div class="input-header">
          <div class="input-title">
            <h3>${data.inputLabel}</h3>
          </div>
        </div>
        
        <div class="input-group-custom">
          <div class="row g-2">
            <div class="col-8">
              <label class="input-label">User ID</label>
              <input 
                type="text" 
                class="form-control custom-input" 
                id="userId" 
                placeholder="${data.inputPlaceholder.userId}"
                required
              >
            </div>
            <div class="col-4">
              <label class="input-label">Zone ID</label>
              <input 
                type="text" 
                class="form-control custom-input" 
                id="zoneId" 
                placeholder="${data.inputPlaceholder.zoneId}"
                required
              >
            </div>
          </div>
          ${
            data.inputHelp
              ? `<small class="text-muted mt-1 d-block">${data.inputHelp}</small>`
              : ""
          }
        </div>
      </div>
    `;
        } else if (data.inputType === "game") {
          return `
      <div class="input-container mb-4">
        <div class="input-header">
          <div class="input-title">
            <h3>${data.inputLabel}</h3>
          </div>
        </div>
        
        <div class="input-group-custom">
          <label class="input-label">User ID</label>
          <input 
            type="text" 
            class="form-control custom-input" 
            id="userId" 
            placeholder="${data.inputPlaceholder}"
            required
          >
          ${
            data.inputHelp
              ? `<small class="text-muted mt-1 d-block">${data.inputHelp}</small>`
              : ""
          }
        </div>
      </div>
    `;
        } else if (data.inputType === "email") {
          return `
      <div class="input-container mb-4">
        <div class="input-header">
          <div class="input-title">
            <h3>${data.inputLabel}</h3>
          </div>
        </div>
        
        <div class="input-group-custom">
          <label class="input-label">Email</label>
          <input 
            type="email" 
            class="form-control custom-input" 
            id="userEmail" 
            placeholder="${data.inputPlaceholder}"
            required
          >
          ${
            data.inputHelp
              ? `<small class="text-muted mt-1 d-block">${data.inputHelp}</small>`
              : ""
          }
        </div>
      </div>
    `;
        } else if (data.inputType === "phone") {
          return `
      <div class="input-container mb-4">
        <div class="input-header">
          <div class="input-title">
            <h3>${data.inputLabel}</h3>
          </div>
        </div>
        
        <div class="input-group-custom">
          <label class="input-label">Nomor HP</label>
          <input 
            type="tel" 
            class="form-control custom-input" 
            id="userPhone" 
            placeholder="${data.inputPlaceholder}"
            pattern="[0-9]*"
            inputmode="numeric"
            required
          >
          ${
            data.inputHelp
              ? `<small class="text-muted mt-1 d-block">${data.inputHelp}</small>`
              : ""
          }
        </div>
      </div>
    `;
        }
      }

      /* ================== TAMPIL CHECKOUT ================== */
      function showCheckout(gameName) {
        const data = checkoutData[gameName];
        const checkout = document.getElementById("checkout");

        // Reset selected item
        selectedItemData.productName = gameName;
        selectedItemData.itemName = "";
        selectedItemData.itemPrice = 0;

        selectedPaymentMethod = {
          id: "",
          name: "",
          totalPrice: 0,
        };

        const bottomNav = document.getElementById("bottom-navbar");
        if (bottomNav) {
          bottomNav.classList.add("d-none");
        }

        checkout.classList.remove("d-none");

        const oldInput = document.getElementById("input-form-section");
        if (oldInput) oldInput.remove();

        const oldPayment = document.getElementById("payment-methods");
        if (oldPayment) oldPayment.remove();

        checkout.innerHTML = `
          <div class="checkout-card mb-4">
            <div class="checkout-header">
              <div class="checkout-img">
                <img src="${data.img}" class="game-icon">
              </div>
              <div class="judul-checkout">
                <h3 class="tag">${data.tag}</h3>
                <h2>${data.title}</h2>
              </div>
            </div>

            <div class="checkout-steps">
              <h3>Cara ${data.cara} ${gameName}</h3>
              <ol>
                ${data.steps.map((s) => `<li>${s}</li>`).join("")}
              </ol>
              <div class="product-badges">
                <span class="badge">Aman terpercaya</span>
                <span class="badge">Garansi 100%</span>
              </div>
            </div>
          </div>

          <div class="nominal-container" id="nominal">
            <div class="p-2 bg-white pt-3">
              <h2 class="mt-3 text-center">${data.diamond}</h2>
              <div class="row justify-content-center row-cols-2 row-cols-md-4 g-3 mb-4 mt-3">
              ${data.diamonds
                .map(
                  (item, index) => `
                <div class="col d-flex justify-content-center">
                  <button class="border-0 bg-white diamond-btn" data-item-name="${
                    item.name
                  }" data-item-price="${item.price}" data-item-index="${index}">
                    <div class="diamond-card">
                      <div class="diamond-body">
                        ${
                          item.img
                            ? `
                          <div class="container-produk-img">
                            <img src="${item.img}" class="produk-img">
                          </div>
                        `
                            : ""
                        }
                        <h3>${item.name}</h3>
                        ${item.bonus ? `<p>${item.bonus}</p>` : ""}
                      </div>
                      <div class="diamond-footer">${item.price}</div>
                    </div>
                  </button>
                </div>
              `
                )
                .join("")}
            </div>
            
            ${
              data.packages && data.packages.length > 0
                ? `
              <div class="p-2 bg-white pt-3">
                <h2 class="mt-3 text-center">${data.paket || ""}</h2>
                <div class="row justify-content-center row-cols-2 row-cols-md-4 g-3 mb-4 mt-3">
                  ${data.packages
                    .map(
                      (item, index) => `
                    <div class="col d-flex justify-content-center">
                      <button class="border-0 bg-white diamond-btn" data-item-name="${item.name}" data-item-price="${item.price}" data-item-index="pkg-${index}">
                        <div class="diamond-card">
                          <div class="diamond-body">
                            <div class="container-produk-img">
                              <img src="${item.img}" class="produk-img" style="margin-bottom:4px">
                            </div>
                            <h3>${item.name}</h3>
                          </div>
                          <div class="diamond-footer">${item.price}</div>
                        </div>
                      </button>
                    </div>
                  `
                    )
                    .join("")}
                </div>
              </div>
            `
                : ""
            }
            </div>
          </div>
        `;

        // Validasi nomor HP
        const phoneInput = document.getElementById("userPhone");
        if (phoneInput) {
          phoneInput.addEventListener("input", function (e) {
            this.value = this.value.replace(/[^0-9]/g, "");
          });
        }

        setTimeout(() => {
          document.querySelectorAll(".diamond-btn").forEach((btn) => {
            btn.addEventListener("click", function () {
              document.querySelectorAll(".diamond-btn").forEach((b) => {
                b.querySelector(".diamond-card").classList.remove("selected");
              });

              this.querySelector(".diamond-card").classList.add("selected");

              const itemName = this.dataset.itemName;
              const priceText = this.dataset.itemPrice;
              const price = parseInt(priceText.replace(/\D/g, ""));

              selectedItemData.itemName = itemName;
              selectedItemData.itemPrice = price;

              showInputForm(data);
              renderPaymentMethods();
              updateBottomNavbar(); // TAMBAHKAN BARIS INI
            });
          });
        }, 100);

        // Scroll ke header
        setTimeout(() => {
          const header = document.querySelector(".checkout-header");
          header.scrollIntoView({ behavior: "smooth", block: "start" });
        }, 100);
      }

      function showInputForm(data) {
        let inputSection = document.getElementById("input-form-section");

        if (!inputSection) {
          inputSection = document.createElement("section");
          inputSection.id = "input-form-section";
          document.getElementById("nominal").after(inputSection);
        }

        inputSection.innerHTML = renderInputForm(data);

        setTimeout(() => {
          const inputs = inputSection.querySelectorAll("input");
          inputs.forEach((input) => {
            input.addEventListener("input", updateBottomNavbar);
          });
        }, 100);

        const phoneInput = document.getElementById("userPhone");
        if (phoneInput) {
          phoneInput.addEventListener("input", function (e) {
            this.value = this.value.replace(/[^0-9]/g, "");
          });
        }

        setTimeout(() => {
          inputSection.scrollIntoView({ behavior: "smooth", block: "start" });
        }, 100);
      }

      function renderPaymentMethods() {
        // Cek apakah section payment-methods sudah ada
        let paymentSection = document.getElementById("payment-methods");

        if (!paymentSection) {
          // Buat section baru jika belum ada
          paymentSection = document.createElement("section");
          paymentSection.id = "payment-methods";
          document.getElementById("checkout").after(paymentSection);
        }

        paymentSection.classList.remove("d-none");

        let paymentHTML = `
    <div class="payment-card mb-4">
      <div class="payment-header">
        <h3>Pilih Metode Pembayaran</h3>
      </div>
  `;

        // Loop through each payment category
        Object.keys(paymentMethods).forEach((category) => {
          const categoryData = paymentMethods[category];
          const totalPrice = selectedItemData.itemPrice + categoryData.fee;

          paymentHTML += `
      <div class="payment-category mb-4">
        <h4 class="category-title">${categoryData.title}</h4>
        <div class="row row-cols-1 row-cols-md-2 g-3">
    `;

          // Loop through methods in category
          categoryData.methods.forEach((method) => {
            paymentHTML += `
        <div class="col">
          <div class="payment-method-item" onclick="selectPaymentMethod('${
            method.id
          }', ${totalPrice}, '${method.name}', '${category}')">
            <div class="payment-method-content">
              <div class="payment-method-info">
                <img src="${method.img}" alt="${
              method.name
            }" class="payment-logo">
                <span class="payment-name">${method.name}</span>
              </div>
              <div class="payment-price">Rp${totalPrice.toLocaleString(
                "id-ID"
              )}</div>
            </div>
          </div>
        </div>
      `;
          });

          paymentHTML += `
        </div>
      </div>
    `;
        });

        paymentHTML += `</div>`;

        paymentSection.innerHTML = paymentHTML;

        // Scroll to payment section
        setTimeout(() => {
          paymentSection.scrollIntoView({ behavior: "smooth", block: "start" });
        }, 100);
      }

      function selectPaymentMethod(methodId, totalPrice, methodName, category) {
        document.querySelectorAll(".payment-method-item").forEach((el) => {
          el.classList.remove("selected");
        });
        event.currentTarget.classList.add("selected");

        selectedPaymentMethod = {
          id: methodId,
          name: methodName,
          category: category,
          totalPrice: totalPrice,
        };

        updateBottomNavbar();
      }

      /* ================== PILIH KATEGORI ================== */
      const buttons = document.querySelectorAll(".category-btn");

      function selectCategory(category) {
        buttons.forEach((b) => b.classList.remove("active"));
        document
          .querySelector(`[data-category="${category}"]`)
          .classList.add("active");

        document.querySelector("#products h2").textContent =
          category.charAt(0).toUpperCase() + category.slice(1);

        renderProducts(products[category]);

        // Hide checkout section
        document.getElementById("checkout").classList.add("d-none");

        // Remove input form section if exists
        const inputSection = document.getElementById("input-form-section");
        if (inputSection) inputSection.remove();

        // Remove payment methods section if exists
        const paymentSection = document.getElementById("payment-methods");
        if (paymentSection) paymentSection.remove();

        // Hide bottom navbar
        const bottomNav = document.getElementById("bottom-navbar");
        if (bottomNav) bottomNav.classList.add("d-none");

        // Reset selected data
        selectedItemData = {
          productName: "",
          itemName: "",
          itemPrice: 0,
        };

        selectedPaymentMethod = {
          id: "",
          name: "",
          totalPrice: 0,
        };

        // Optional: Reset checkoutData if needed (but keep it for performance)
        // checkoutData = {};

        document
          .getElementById("products")
          .scrollIntoView({ behavior: "smooth" });
      }

      buttons.forEach((btn) => {
        btn.addEventListener("click", () => {
          selectCategory(btn.dataset.category);
        });
      });

      // Nomor WhatsApp tujuan
      const waNumberBanner = "6281380368831";

      // Event untuk tombol di banner "Hubungi Kami"
      document
        .querySelector(".get-started-section .btn")
        .addEventListener("click", () => {
          const text = encodeURIComponent(
            "Halo, saya mengalami kendala dalam transaksi di TuanMuda. Mohon bantuannya."
          );
          const waLink = `https://wa.me/${waNumberBanner}?text=${text}`;
          window.open(waLink, "_blank");
        });

      // Efek hover kecil untuk ikon sosial
      document.querySelectorAll(".footer-socials a img").forEach((icon) => {
        icon.addEventListener("mouseenter", () => {
          icon.style.filter = "brightness(1.2)";
        });
        icon.addEventListener("mouseleave", () => {
          icon.style.filter = "brightness(1)";
        });
      });

      document.getElementById("privacyLink").addEventListener("click", (e) => {
        e.preventDefault();
        const modal = new bootstrap.Modal(
          document.getElementById("privacyModal")
        );
        modal.show();
      });

      document.getElementById("termsLink").addEventListener("click", (e) => {
        e.preventDefault();
        const modal = new bootstrap.Modal(
          document.getElementById("termsModal")
        );
        modal.show();
      });

      // Load testimonials dari database
      async function loadTestimonials() {
        try {
          // TIDAK ada parameter show_all, jadi hanya ambil yang aktif
          const response = await fetch("backend/get_testimonials.php");
          const result = await response.json();

          if (result.success && result.data.length > 0) {
            const testimonials = result.data;

            console.log(`Total testimonial aktif: ${testimonials.length}`); // DEBUG

            // Split menjadi 2 bagian untuk carousel atas dan bawah
            const half = Math.ceil(testimonials.length / 2);
            const topTestimonials = testimonials.slice(0, half);
            const bottomTestimonials = testimonials.slice(half);

            // Render testimonials atas (2 kali untuk infinite scroll)
            renderTestimonials(topTestimonials, "testi-atas-1");
            renderTestimonials(topTestimonials, "testi-atas-2");

            // Render testimonials bawah (2 kali untuk infinite scroll)
            renderTestimonials(bottomTestimonials, "testi-bawah-1");
            renderTestimonials(bottomTestimonials, "testi-bawah-2");
          } else {
            console.log("Tidak ada testimonial aktif"); // DEBUG
          }
        } catch (error) {
          console.error("Error loading testimonials:", error);
        }
      }

      function renderTestimonials(testimonials, containerId) {
        const container = document.getElementById(containerId);

        container.innerHTML = testimonials
          .map((t) => {
            const fullStars = Math.floor(t.rating);
            const hasHalfStar = t.rating % 1 !== 0;

            let starsHTML = "";
            for (let i = 0; i < fullStars; i++) {
              starsHTML += '<i class="bi bi-star-fill"></i>';
            }
            if (hasHalfStar) {
              starsHTML += '<i class="bi bi-star-half"></i>';
            }
            for (let i = Math.ceil(t.rating); i < 5; i++) {
              starsHTML += '<i class="bi bi-star"></i>';
            }

            return `
                <div class="col-md-4 col-sm-6">
                    <div class="testimonial-card">
                        <div class="stars">${starsHTML}</div>
                        <p class="testimonial-text">"${t.text}"</p>
                        <div class="profile">
                            <img src="https://randomuser.me/api/portraits/${
                              t.gender === "male" ? "men" : "women"
                            }/${t.avatar_seed}.jpg" 
                                alt="${t.name}">
                            <h6>${t.name}</h6>
                        </div>
                    </div>
                </div>
            `;
          })
          .join("");
      }

      // Load testimonials saat halaman dimuat
      document.addEventListener("DOMContentLoaded", () => {
        loadProductsFromDB();
        loadTestimonials(); // Tambahkan ini
      });

      // render awal
      document.addEventListener("DOMContentLoaded", () => {
        loadProductsFromDB();
      });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
